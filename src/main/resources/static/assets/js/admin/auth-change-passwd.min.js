var main;function initApp(){main=new Vue({el:"#main",data:{currentUserId:0,currentUserName:"",currentAddStartValid:!1,currentAddPasswdStartValid:!1,currentAddPasswd2StartValid:!1,currentAddUserName:"",currentAddUserFriendlyName:"",currentAddUserPasswordOld:"",currentAddUserPassword:"",currentAddUserPassword2:"",currentAddSuccess:!1},methods:{init(){$("#change_new").focus(function(){main.currentAddPasswdStartValid=!0,$("#password_type").slideDown()}),$("#change_new").blur(function(){main.preSubmitValid()||$("#password_type").slideUp()}),$("#change_new2").focus(function(){main.currentAddPasswd2StartValid=!0})},validPassWord0(){return this.currentAddStartValid&&isNullOrEmpty(this.currentAddUserPasswordOld)?" is-invalid":""},validPassWord1(){return this.currentAddPasswdStartValid&&(this.validPassWord1Len()||this.validPassWord1Char()||this.validPassWord1UserName())?" is-invalid":""},validPassWord1Len(){return isNullOrEmpty(this.currentAddUserPassword)||this.currentAddUserPassword.length<8},validPassWord1Char(){return!new RegExp(/(?!^(\d+|[a-zA-Z]+|[~!@#$%^&*?]+)$)^[\w~!@#$%\^&*?]+$/).test(this.currentAddUserPassword)},validPassWord1UserName(){var u=this.currentUserName;return u==this.currentAddUserPassword||this.currentAddUserPassword.indexOf(u)>=0},validPassWord2(){return!this.currentAddStartValid&&!this.currentAddPasswd2StartValid||!isNullOrEmpty(this.currentAddUserPassword2)&&this.currentAddUserPassword==this.currentAddUserPassword2?"":" is-invalid"},preSubmitValid(){return" is-invalid"==this.validPassWord0()||" is-invalid"==this.validPassWord2()||!!(this.validPassWord1Len()||this.validPassWord1Char()||this.validPassWord1UserName())},submitChange(){if(this.currentAddStartValid=!0,this.preSubmitValid())$("#password_type").slideDown();else if(main.currentAddUserPasswordOld!=main.currentAddUserPassword){var t=toast("正在提交中...","loading",-1);$.ajax({url:address_blog_api+"user/"+main.currentUserId+"/password",type:"post",dataType:"json",data:JSON.stringify({oldPassword:md5(main.currentAddUserPasswordOld),newPassword:md5(main.currentAddUserPassword)}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(response){toastClose(t),response.success?main.currentAddSuccess=!0:swal("修改密码失败",response.message,"error")},error:function(xhr,err){toastClose(t),toast("修改密码失败 : "+err,"error",5e3)}})}else swal("新密码不可与旧密码相同哦！","","warning")}}})}setLoaderNotHideMask(),setLoaderFinishCallback(function(){initApp(),$.ajax({url:address_blog_api+"auth/auth-test",type:"get",contentType:"application/json; charset=utf-8",success:function(response){!isNullOrEmpty(response)&&response.success?(currentAuthedUser=response.data,main.currentUserId=currentAuthedUser.id,main.currentUserName=currentAuthedUser.name,$(".current-user-name").html(currentAuthedUser.name+"<i></i>"),$(".current-user-head").attr("src",getImageUrlFormHash(currentAuthedUser.headimg)),setTimeout(function(){setLoaderHideMaskNow(),main.init()},500)):"-3"==response.extendCode?location.href="/sign-in/?redirect_url="+encodeURI(location.href)+"&error=SessionOut":location.href="/sign-in/?redirect_url="+encodeURI(location.href)+"&error=RequestLogin"},error:function(xhr,err){swal("连接服务器异常","请检查您的连接？","error")}})});