var main;function initAuthInfoEnd(user){main.userInfoLoaded=!0,user&&(getUserHasPrivilege(user,userPrivileges.globalSettings)||user.level==userLevels.admin)&&(user.level!=userLevels.admin&&0==(user.privilege&userPrivileges.manageAllArchives)||(main.userHasManagePrivilege=!0),main.currentUser=user,main.loadSettings())}function initApp(){main=new Vue({el:"#main",data:{contentLoadStatus:contentLoadStatus,content:null,userInfoLoaded:!1,userHasManagePrivilege:!1,currentUser:null,settingsData:null,settingsOldData:null,settingsLoadFailed:!1,tableAllPageSize:10,tableAllLoadStatus:"notload",tableAllDatas:null,tableAllColumns:[{width:"auto",text:"时间",useData:"name",dataName:"datetime"},{width:"auto",text:"操作",useData:"name",dataName:"action"},{width:"90px",text:"操作用户/IP",useData:"custom",customDataFunc:function(item){return'<span class="badge badge-pill badge-primary mr-2">'+item.userId+"</span>"+item.userName+'<br/><span class="text-secondary">'+item.ip+"</span>"}}],tableAllPageCurrent:1,tableAllPageAll:1,anySetFailed:!1,setSendStats:!0,setAnonymousComment:!0,setMaxStatSaveDays:30,setimageCenter:"",setEnableSearch:!0,setEnableRegister:!0,setsideCustomArea:"",version:"未知"},methods:{isCurrentUrlAndActive:function(page){return isCurrentUrlAndActive(page)},findSet(name){for(var key in main.settingsData)if(main.settingsData[key].name==name)return main.settingsData[key];return null},loadSettings(){$.ajax({url:address_blog_api+"settings",success:function(response){response.success?(main.settingsData=response.data,main.setSendStats="true"==main.findSet("sendStats").data,main.setAnonymousComment="true"==main.findSet("anonymousComment").data,main.setMaxStatSaveDays=parseInt(main.findSet("maxStatSaveDays").data),main.setimageCenter=main.findSet("imageCenter").data,main.setsideCustomArea=base64.decode(main.findSet("sideCustomArea").data.replace(" ","+")),main.setEnableSearch="true"==main.findSet("enableSearch").data):(toast("加载设置失败！"+response.message,"error",5e3),main.settingsLoadFailed=!0)},error:function(xhr,err){toast("加载设置失败！"+err,"error",5e3),main.settingsLoadFailed=!0}})},loadOpLog(force){(force||"loaded"!=this.tableAllLoadStatus)&&(main.tableAllLoadStatus="loading",$.ajax({url:address_blog_api+"stat/oplog/"+(main.tableAllPageCurrent-1)+"/"+main.tableAllPageSize,success:function(response){main.tableAllLoadStatus="loaded",response.success?(main.tableAllDatas=response.data.content,main.tableAllPageCurrent=response.data.number+1,main.tableAllPageAll=response.data.totalPages):main.tableAllLoadStatus="failed"},error:function(xhr,err){main.tableAllLoadStatus="failed"}}))},loadVersion(){$.ajax({url:address_blog_api+"version",success:function(response){response.success&&(main.version=response.data)},error:function(xhr,err){}})},saveSettings(){main.anySetFailed=!1,main.setSendStats!=("true"==main.findSet("sendStats").data)&&main.updateSettings("sendStats",main.setSendStats?"true":"false"),main.setAnonymousComment!=("true"==main.findSet("anonymousComment").data)&&main.updateSettings("anonymousComment",main.setAnonymousComment?"true":"false"),main.setMaxStatSaveDays!=main.findSet("maxStatSaveDays").data&&main.updateSettings("maxStatSaveDays",main.setMaxStatSaveDays),main.setimageCenter!=main.findSet("imageCenter").data&&main.updateSettings("imageCenter",main.setimageCenter),base64.encode(main.setsideCustomArea)!=main.findSet("sideCustomArea").data&&main.updateSettings("sideCustomArea",base64.encode(main.setsideCustomArea)),main.setEnableSearch!=("true"==main.findSet("enableSearch").data)&&main.updateSettings("enableSearch",main.setEnableSearch?"true":"false"),main.setEnableRegister!=("true"==main.findSet("enableRegister").data)&&main.updateSettings("enableRegister",main.setEnableRegister?"true":"false"),main.anySetFailed||toast("保存设置成功","success",3e3)},updateSettings(name,val){$.ajax({url:address_blog_api+"settings/"+name,type:"post",data:"value="+val,success:function(response){response.success||(toast("保存设置 "+name+" 失败！"+response.message,"error",5e3),main.anySetFailed=!0)},error:function(xhr,err){toast("保存设置 "+name+" 失败！"+err,"error",5e3),main.anySetFailed=!0}})},tableAllPagerClick(item){main.tableAllPageCurrent!=item&&(main.tableAllPageCurrent=item,main.loadOpLog(!0))},tableAllPageSizeChanged(newv){main.tableAllPageSize!=newv&&(main.tableAllPageSize=newv,main.tableAllLoadStatus="notload",main.loadOpLog(!0))}}})}appendLoaderJS("/assets/js/components/common-table.min.js"),appendLoaderJS("/assets/js/components/common-pagination.min.js"),appendLoaderJS("/assets/libs/compress/base64.min.js");