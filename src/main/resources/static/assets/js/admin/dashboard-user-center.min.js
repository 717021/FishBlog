var main;function initAuthInfoEnd(user){main.userInfoLoaded=!0,user&&(getUserHasPrivilege(user,userPrivileges.manageUsers)||user.level==userLevels.admin)?(user.level!=userLevels.admin&&0==(user.privilege&userPrivileges.manageAllArchives)||(main.userHasManagePrivilege=!0),main.currentUser=user,setTimeout(function(){"男"==user.gender?$("#radioMale").prop("checked",!0):"女"==user.gender&&$("#radioFemale").prop("checked",!1)},500)):main.tableUsersLoadStatus="noprivilege"}function initApp(){main=new Vue({el:"#main",data:{contentLoadStatus:contentLoadStatus,content:null,userInfoLoaded:!1,userHasManagePrivilege:!1,currentUser:null,currentUserIsMale:!1,currentUserIsFemale:!1,currentStartValid:!1},methods:{isCurrentUrlAndActive:function(page){return isCurrentUrlAndActive(page)},changeHead(b){b?this.uploadFile():$("#avatar").click()},uploadFile(){var avatar=document.getElementById("avatar"),fileObj=avatar.files[0],url=blog_api_address+"user/"+main.currentUser.id+"/head",uploadComplete=function(evt){var data=JSON.parse(evt.target.responseText);data.success?(main.currentUser.headimg=data.data,toast("更换头像成功","success",5e3)):toast("上传头像失败！"+data.message+" ( "+data.extendCode+" )","error",5e3)},uploadFailed=function uploadFailed(evt){toast("上传头像失败！请检查您的网络","error",5e3)},form=new FormData;form.append("file",fileObj),xhr=new XMLHttpRequest,xhr.open("post",url,!0),xhr.onload=uploadComplete,xhr.onerror=uploadFailed,xhr.send(form),avatar.value=""},setGender(m){m?(main.currentUser.gender="男",$("#radioMale").prop("checked",!0),$("#radioFemale").prop("checked",!1)):(main.currentUser.gender="女",$("#radioMale").prop("checked",!1),$("#radioFemale").prop("checked",!0))},getUserHead:()=>isNullOrEmpty(main.currentUser.headimg)?"/images/default/head-default.png":getImageUrlFormHash(main.currentUser.headimg),submit(){if(this.currentStartValid=!0,!isNullOrEmpty(main.currentUser.friendlyName)){var t=toast("正在提交中...","loading",-1);$.ajax({url:blog_api_address+"user/"+main.currentUser.id,type:"put",dataType:"json",data:JSON.stringify(main.currentUser),contentType:"application/json; charset=utf-8",dataType:"json",success:function(response){toastClose(t),response.success?toast("修改个人信息成功！","success",5e3):swal("修改个人信息失败",response.message,"error")},error:function(xhr,err){toastClose(t),toast("修改个人信息失败 : "+err,"error",5e3)}})}}}})}