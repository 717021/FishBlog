var main;function initAuthInfoEnd(user){main.userInfoLoaded=!0,user?(main.currentUser=user,setTimeout(function(){"男"==user.gender?$("#radioMale").prop("checked",!0):"女"==user.gender&&$("#radioFemale").prop("checked",!0)},500)):main.tableUsersLoadStatus="noprivilege"}function initApp(){main=new Vue({el:"#main",data:{contentLoadStatus:contentLoadStatus,content:null,userInfoLoaded:!1,userHasManagePrivilege:!1,currentUser:null,currentUserIsMale:!1,currentUserIsFemale:!1,currentStartValid:!1},methods:{isCurrentUrlAndActive:function(page){return isCurrentUrlAndActive(page)},changeHead(b){b?this.uploadFile():$("#avatar").click()},uploadFile(){var avatar=document.getElementById("avatar"),fileObj=avatar.files[0],url=address_blog_api+"user/"+main.currentUser.id+"/head",t=toast("正在上传...","loading",-1),uploadComplete=function(evt){toastClose(t);var data=JSON.parse(evt.target.responseText);data.success?(main.currentUser.headimg=data.data,toast("更换头像成功","success",5e3)):toast("上传头像失败！"+data.message+" ( "+data.extendCode+" )","error",5e3)},uploadFailed=function uploadFailed(evt){toastClose(t),toast("上传头像失败！请检查您的网络","error",5e3)},form=new FormData;form.append("file",fileObj),xhr=new XMLHttpRequest,xhr.open("post",url,!0),xhr.onload=uploadComplete,xhr.onerror=uploadFailed,xhr.send(form),avatar.value=""},setGender(m){m?(main.currentUser.gender="男",$("#radioMale").prop("checked",!0),$("#radioFemale").prop("checked",!1)):(main.currentUser.gender="女",$("#radioMale").prop("checked",!1),$("#radioFemale").prop("checked",!0))},getUserHead:()=>isNullOrEmpty(main.currentUser.headimg)?"/images/default/head-default.png":getImageUrlFormHash(main.currentUser.headimg),submit(){if(this.currentStartValid=!0,!isNullOrEmpty(main.currentUser.friendlyName)){var t=toast("正在提交中...","loading",-1);$.ajax({url:address_blog_api+"user/"+main.currentUser.id,type:"put",dataType:"json",data:JSON.stringify(main.currentUser),contentType:"application/json; charset=utf-8",dataType:"json",success:function(response){toastClose(t),response.success?toast("修改个人信息成功！","success",5e3):swal("修改个人信息失败",response.message,"error")},error:function(xhr,err){toastClose(t),toast("修改个人信息失败 : "+err,"error",5e3)}})}},getLevelCurrentUser(){var html="",user=main.currentUser;return user.level==userLevels.admin?html='<span class="tag-post-prefix bg-danger">管理员</span>':user.level==userLevels.writer?html='<span class="tag-post-prefix bg-primary">作者</span>':user.level==userLevels.guest?html='<span class="tag-post-prefix bg-success">游客</span>':0==user.level&&(html='<span class="tag-post-prefix bg-secondary">已封禁</span>'),html},getPrivilegeCurrentUser(){var html="",user=main.currentUser;return user.level==userLevels.admin?html+='<div class="tag-mgr-item bg-dark text-white cursor-pointer pr-3">管理员拥有所有权限</div>':(getUserHasPrivilege(user,userPrivileges.manageAllArchives)&&(html+='<div class="tag-mgr-item bg-danger text-white cursor-pointer pr-3">管理所有文章权限</div>'),getUserHasPrivilege(user,userPrivileges.manageClassAndTags)&&(html+='<div class="tag-mgr-item bg-primary text-white cursor-pointer pr-3">管理分类标签权限</div>'),getUserHasPrivilege(user,userPrivileges.manageMediaCenter)&&(html+='<div class="tag-mgr-item bg-info text-white cursor-pointer pr-3">管理媒体库权限</div>'),getUserHasPrivilege(user,userPrivileges.manageUsers)&&(html+='<div class="tag-mgr-item bg-dark text-white cursor-pointer pr-3">管理其他用户权限</div>'),getUserHasPrivilege(user,userPrivileges.gaintPrivilege)&&(html+='<div class="tag-mgr-item bg-primary text-white cursor-pointer pr-3">授予用户权限权限</div>'),getUserHasPrivilege(user,userPrivileges.globalSettings)&&(html+='<div class="tag-mgr-item bg-warning text-white cursor-pointer pr-3">修改系统设置权限</div>')),html}}})}