appendLoaderJS("/assets/libs/chartjs/Chart.min.js"),appendLoaderJS("/assets/js/components/common-table.min.js"),appendLoaderJS("/assets/js/components/common-pagination.min.js");var main=null;function initAuthInfoEnd(user){main.userInfoLoaded=!0,user&&(user.level!=userLevels.admin&&0==(user.privilege&userPrivileges.manageAllArchives)||(main.userHasManagePrivilege=!0),main.currentUser=user,main.loadTable("all"))}function initApp(){main=new Vue({el:"#main",data:{contentLoadStatus:contentLoadStatus,content:null,userInfoLoaded:!1,userHasManagePrivilege:!1,currentUser:null,tableAllAnyDeleted:!1,tableAllShowAllUserArchive:!1,tableAllPageSize:10,tableAllLoadStatus:"notload",tableAllDatas:null,tableAllColumns:[{width:"30px",text:"#",useData:"name",dataName:"id"},{width:"70px",text:"",useData:"custom",customDataFunc:function(item){return getPostPrefix(item.postPrefix)}},{width:"auto",text:"文章名称",useData:"name",dataName:"title",useLink:!0},{width:"auto",text:"所属分类",useData:"custom",customDataFunc:function(item){return item.postClass?item.postClass.split(":")[1]:""}},{width:"130px",text:"浏览/评论",useData:"custom",customDataFunc:function(item){return item.viewCount+" / "+item.commentCount}},{width:"90px",text:"文章状态",useData:"custom",customDataFunc:function(item){switch(item.status){case 0:return"私有文章";case 1:return"公开文章";case 2:return"文章草稿"}return""}},{width:"150px",text:"操作",useSlot:!0,slotName:"marchives-slot"}],tableAllPageCurrent:1,tableAllPageAll:1,tablePublishAnyDeleted:!1,tablePublishPageSize:10,tablePublishLoadStatus:"notload",tablePublishDatas:null,tablePublishColumns:[{width:"30px",text:"#",useData:"name",dataName:"id"},{width:"70px",text:"",useData:"custom",customDataFunc:function(item){return getPostPrefix(item.postPrefix)}},{width:"auto",text:"文章名称",useData:"name",dataName:"title",useLink:!0},{width:"auto",text:"所属分类",useData:"custom",customDataFunc:function(item){return item.postClass?item.postClass.split(":")[1]:""}},{width:"130px",text:"浏览/评论",useData:"custom",customDataFunc:function(item){return item.viewCount+" / "+item.commentCount}},{width:"150px",text:"操作",useSlot:!0,slotName:"marchives-slot"}],tablePublishPageCurrent:1,tablePublishPageAll:1,tableDrafthAnyDeleted:!1,tableDraftPageSize:10,tableDraftLoadStatus:"notload",tableDraftDatas:null,tableDraftColumns:[{width:"30px",text:"#",useData:"name",dataName:"id"},{width:"70px",text:"",useData:"custom",customDataFunc:function(item){return getPostPrefix(item.postPrefix)}},{width:"auto",text:"文章名称",useData:"name",dataName:"title"},{width:"auto",text:"所属分类",useData:"custom",customDataFunc:function(item){return item.postClass?item.postClass.split(":")[1]:""}},{width:"auto",text:"最近一次的修改时间",useData:"custom",customDataFunc:function(item){return item.lastmodifyDate?item.lastmodifyDate:item.postDate}},{width:"200px",text:"操作",useSlot:!0,slotName:"marchives-draft-slot"}],tableDraftPageCurrent:1,tableDraftPageAll:1},methods:{isCurrentUrlAndActive:function(page){return isCurrentUrlAndActive(page)},tableAnyDeleted(){main.tableAllAnyDeleted=!0,main.tablePublishAnyDeleted=!0,main.tableDrafthAnyDeleted=!0},tableItemClick(item){window.open(getPostRealUrl(item))},tableItemEditClick(itemId){window.open("../write-archive/?archive="+itemId)},tableGenItemIds(selItems){var delPosts={archives:[]},i=0;for(var key in selItems)delPosts.archives[i]=selItems[key].id,i++;return delPosts},tableDeleteItem(itemId,successCallback){Swal.fire({type:"warning",title:"您真的要删除这一篇文章吗?",text:"注意，此操作不能恢复！",confirmButtonColor:"#d33",confirmButtonText:"确定删除",showCancelButton:!0,cancelButtonColor:"#3085d6",cancelButtonText:"取消",focusCancel:!0,reverseButtons:!0}).then(isConfirm=>{isConfirm.value&&$.ajax({url:blog_api_address+"/post/"+itemId,type:"delete",success:function(response){main.tableAllLoadStatus="loaded",response.success?(toast("成功删除一篇文章","success"),successCallback()):swal("删除失败",response.message,"error")},error:function(xhr,err){swal("删除失败",err,"error")}})})},tableDeleteSelect(selItems,successCallback){var delPosts=this.tableGenItemIds(selItems);Swal.fire({type:"warning",title:"您真的要删除选中的 "+Object.keys(selItems).length+" 篇文章吗?",text:"注意，此操作不能恢复！",confirmButtonColor:"#d33",confirmButtonText:"确定删除",showCancelButton:!0,cancelButtonColor:"#3085d6",cancelButtonText:"取消",focusCancel:!0,reverseButtons:!0}).then(isConfirm=>{isConfirm.value&&$.ajax({url:blog_api_address+"/posts",type:"delete",data:JSON.stringify(delPosts),contentType:"application/json; charset=utf-8",dataType:"json",contentType:"application/json; charset=utf-8",success:function(response){main.tableAllLoadStatus="loaded",response.success?(toast("删除所选文章成功","success"),successCallback()):swal("删除失败",response.message,"error")},error:function(xhr,err){swal("删除失败",err,"error")}})})},tableAllPagerClick(item){main.tableAllPageCurrent!=item&&(main.tableAllPageCurrent=item,main.reloadTable("all"))},tableAllPageSizeChanged(newv){main.tableAllPageSize!=newv&&(main.tableAllPageSize=newv,main.tableAllLoadStatus="notload",main.loadTable("all"))},tableAllCustomItemClick(customerControlId,item){if("del-all"==customerControlId){var selItems=main.$refs.tableAll.getCheckedItems();selItems&&0!=Object.keys(selItems).length?main.tableDeleteSelect(selItems,function(){main.tableAnyDeleted(),main.$refs.tableAll.unCheckAll(),main.reloadTable("all")}):swal("删除","请至少选中一个条目！","warning")}else"del"==customerControlId?main.tableDeleteItem(item.id,function(){main.tableAnyDeleted(),main.$refs.tableAll.unCheckAll(),main.reloadTable("all")}):"edit"==customerControlId?main.tableItemEditClick(item.id):"switch-show-all"==customerControlId&&main.reloadTable("all")},tablePublishPagerClick(item){main.tablePublishPageCurrent!=item&&(main.tablePublishPageCurrent=item,main.reloadTable("publish"))},tablePublishPageSizeChanged(newv){main.tablePublishPageSize!=newv&&(main.tablePublishPageSize=newv,main.tablePublishLoadStatus="notload",main.loadTable("publish"))},tablePublishCustomItemClick(customerControlId,item){if("del-all"==customerControlId){var selItems=main.$refs.tablePublish.getCheckedItems();selItems&&0!=Object.keys(selItems).length?main.tableDeleteSelect(selItems,function(){main.tableAnyDeleted(),main.$refs.tablePublish.unCheckAll(),main.reloadTable("publish")}):swal("删除","请至少选中一个条目！","warning")}else"del"==customerControlId?main.tableDeleteItem(item.id,function(){main.tableAnyDeleted(),main.$refs.tablePublish.unCheckAll(),main.reloadTable("publish")}):"edit"==customerControlId&&main.tableItemEditClick(item.id)},tableDraftPagerClick(item){main.tableDraftPageCurrent!=item&&(main.tableDraftPageCurrent=item,main.reloadTable("draft"))},tableDraftPageSizeChanged(newv){main.tableDraftPageSize!=newv&&(main.tableDraftPageSize=newv,main.tableDraftLoadStatus="notload",main.loadTable("draft"))},tableDraftCustomItemClick(customerControlId,item){if("del-all"==customerControlId){var selItems=main.$refs.tableDraftC.getCheckedItems();selItems&&0!=Object.keys(selItems).length?main.tableDeleteSelect(selItems,function(){main.tableAnyDeleted(),main.$refs.tableDraftC.unCheckAll(),main.reloadTable("craft")}):swal("删除","请至少选中一个条目！","warning")}else"del"==customerControlId?main.tableDeleteItem(item.id,function(){main.tableAnyDeleted(),main.$refs.tableDraft.unCheckAll(),main.reloadTable("craft")}):"edit"==customerControlId?main.tableItemEditClick(item.id):"publish"==customerControlId&&window.open("../write-archive/?archive="+item.id+"&publish=click")},reloadTable(page){"all"==page?main.tableAllLoadStatus="notload":"publish"==page?main.tablePublishLoadStatus="notload":"draft"==page&&(main.tableDrafthLoadStatus="notload"),this.loadTable(page)},loadTable:function(page){"all"!=page||!this.tableAllAnyDeleted&&"loaded"==this.tableAllLoadStatus?"publish"!=page||!this.tablePublishAnyDeleted&&"loaded"==this.tablePublishLoadStatus?"draft"!=page||!this.tableDraftAnyDeleted&&"loaded"==this.tableDraftLoadStatus||(main.tableDraftAnyDeleted=!1,main.tableDraftLoadStatus="loading",$.ajax({url:blog_api_address+"/posts/page/"+(main.tableDraftPageCurrent-1)+"/"+main.tableDraftPageSize+"?sortBy=date&byStatus=draft&byUser="+main.currentUser.id,success:function(response){main.tableDraftLoadStatus="loaded",response.success?(main.tableDraftDatas=response.data.content,main.tableDraftPageCurrent=response.data.number+1,main.tableDraftPageAll=response.data.totalPages):main.tableDraftLoadStatus="failed"},error:function(xhr,err){main.tableDraftLoadStatus="failed"}})):(main.tablePublishAnyDeleted=!1,main.tablePublishLoadStatus="loading",$.ajax({url:blog_api_address+"/posts/page/"+(main.tablePublishPageCurrent-1)+"/"+main.tablePublishPageSize+"?sortBy=date&byStatus=publish&byUser="+main.currentUser.id,success:function(response){main.tablePublishLoadStatus="loaded",response.success?(main.tablePublishDatas=response.data.content,main.tablePublishPageCurrent=response.data.number+1,main.tablePublishPageAll=response.data.totalPages):main.tablePublishLoadStatus="failed"},error:function(xhr,err){main.tablePublishLoadStatus="failed"}})):(main.tableAllAnyDeleted=!1,main.tableAllLoadStatus="loading",$.ajax({url:blog_api_address+"/posts/page/"+(main.tableAllPageCurrent-1)+"/"+main.tableAllPageSize+"?sortBy=date&byStatus=all&byUser="+(main.tableAllShowAllUserArchive?"0":main.currentUser.id),success:function(response){main.tableAllLoadStatus="loaded",response.success?(main.tableAllDatas=response.data.content,main.tableAllPageCurrent=response.data.number+1,main.tableAllPageAll=response.data.totalPages):main.tableAllLoadStatus="failed"},error:function(xhr,err){main.tableAllLoadStatus="failed"}}))}}})}