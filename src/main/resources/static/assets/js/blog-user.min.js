var main=new Vue({el:"#main",data:{currentAuthedUser:null,currentAuthed:!1,currentUserEditing:!1,currentUser:null,currentUserLoadStatus:"notload",currentUserLoadError:""},methods:{loadUser:function(){var currentUserId=getQueryString("user");null==currentUserId&&(currentUserId=getLastUrlAgrs(location.href).arg),isNumber(currentUserId)&&"user"!=currentUserId||(currentUserId="0");var url=address_blog_api+"user/"+currentUserId;$.ajax({url:url,success:function(response){response.success?(main.currentUserLoadStatus="loaded",main.currentUser=response.data,main.currentAuthedUser&&main.currentAuthedUser.id==main.currentUser.id&&(main.currentAuthed=!0)):(main.currentUserLoadStatus="failed",main.currentUserLoadError=response.message)},error:function(xhr,err){main.currentUserLoadStatus="failed",main.currentUserLoadError=err}})},edit(){this.currentAuthedUser&&(this.currentAuthedUser.level==userLevels.writer||this.currentAuthedUser.level==userLevels.admin?location.href="/admin/user-center/":(this.currentUserEditing=!0,setTimeout(function(){"男"==main.currentUser.gender?($("#radioMale").prop("checked",!0),$("#radioFemale").prop("checked",!1)):"女"==main.currentUser.gender&&($("#radioMale").prop("checked",!1),$("#radioFemale").prop("checked",!0))},200)))},save(){var t=toast("正在提交中...","loading",-1);$.ajax({url:address_blog_api+"user/"+main.currentUser.id,type:"put",dataType:"json",data:JSON.stringify(main.currentUser),contentType:"application/json; charset=utf-8",dataType:"json",success:function(response){toastClose(t),response.success?(toast("修改个人信息成功！","success",5e3),this.currentUserEditing=!1):swal("修改个人信息失败",response.message,"error")},error:function(xhr,err){toastClose(t),toast("修改个人信息失败 : "+err,"error",5e3)}})},setGender(m){m?(main.currentUser.gender="男",$("#radioMale").prop("checked",!0),$("#radioFemale").prop("checked",!1)):(main.currentUser.gender="女",$("#radioMale").prop("checked",!1),$("#radioFemale").prop("checked",!0))},getFriendlyName(){return this.currentUser?isNullOrEmpty(this.currentUser.friendlyName)?this.currentUser.name:this.currentUser.friendlyName:"加载失败"},getUserHead:()=>isNullOrEmpty(main.currentUser.headimg)?"/images/default/head-default.png":getImageUrlFormHash(main.currentUser.headimg),getUserCardBackground:()=>isNullOrEmpty(main.currentUser.cardBackground)?"/images/background/mebg.jpg":getImageUrlFormHash(main.currentUser.cardBackground)}});function initAuthInfoEnd(authedUser){authedUser&&(main.currentAuthedUser=authedUser,main.currentUser&&main.currentUser.id==main.currentAuthedUser.id&&(main.currentAuthed=!0))}setLoaderFinishCallback(function(){main.loadUser()});