function mergeJSON(minor,main){for(var key in minor)void 0!==main[key]&&(isJSON(minor[key])||isArray(minor[key]))?main[key]=mergeJSON(minor[key],main[key]):main[key]=minor[key];return main}function isJSON(target){return"object"==typeof target&&target.constructor==Object}function isArray(o){return"[object Array]"==Object.prototype.toString.call(o)}function mergeJsonArray(a,b){var r={},i=0;for(var key in a)r[i]=a[key],i++;for(var key in b)r[i]=b[key],i++;return r}function getLastUrlAgrs(url){url.lastIndexOf("/")>0&&(url=url.substr(0,url.lastIndexOf("/")));var rp=url.lastIndexOf("/"),rs={arg:"",removedStr:""};return rp>0&&(rs.arg=url.substr(rp+1),rs.removedStr=url.substr(0,rp)),rs}function getLastHashAgr(url){return url.lastIndexOf("#")>0?url.split("#")[1]:rs}function getCurrentFullHost(){return location.protocol+"//"+location.host}function getPostPrefix(prefixId){switch(prefixId){case 0:return"";case 1:return'<span class="tag-post-prefix original">原创</span>';case 2:return'<span class="tag-post-prefix reprint">转载</span>';case 3:return'<span class="tag-post-prefix album">视频</span>';case 4:return'<span class="tag-post-prefix video">相册</span>'}return""}function getImageUrlFormHash(str){return str&&0==str.indexOf("http")?str:str?address_image_center+str+".jpg":str}function getImageUrlFormHashWithType(hash,type){var ftype=type||"jpg";return hash&&0==hash.indexOf("http")?hash:hash?address_image_center+hash+"."+ftype:hash}function getPostRealUrl(post){return partPositions.viewPost+(post.urlName?post.urlName.replace(/\+/g," "):post.id)+"/"}function getClassRealUrl(post){return partPositions.viewClass+(post.urlName?post.urlName.replace(/\+/g," "):post.id)+"/"}function getQueryString(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[2]):null}function getUserHasPrivilege(userData,privilege){return!!userData&&0!=(userData.privilege&privilege)}function genUserMenuInfo(userData){var userMsgPoint=userData.messageCount?'<span class="current-user-message-count">'+userData.messageCount+"</span>":"",userName=isNullOrEmpty(userData.friendlyName)?userData.name:userData.friendlyName,userHead=isNullOrEmpty(userData.headimg)?"/images/default/head-default.png":getImageUrlFormHash(userData.headimg);userData.level==userLevels.admin||userData.level==userLevels.writer?($("#header-menu").append($('<li class="nav-user">'+("/admin/write-archive/"!=location.pathname?'<button type="button" class="flat-pill flat-btn flat-btn-transparent flat-danger mr-2" onclick="location.href = \'/admin/write-archive/\'">写文章</button>':"")+'<div><img class="current-user-head" src="'+userHead+'">'+userMsgPoint+'</div><div id="current_user_dropdown" class="dropdown"><span id="current_user_name" class="current-user-name" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-offset="0,20">'+userName+"<i></i></span></div></li>")),$("#current_user_dropdown").append($('<div class="dropdown-menu dropdown-menu-right">      <a class="dropdown-item" href="/admin/write-archives/">写文章/a>      <a class="dropdown-item" href="/admin/manage-archives/">文章管理</a>      <a class="dropdown-item" href="/admin/user-center/">个人信息</a>      <div class="dropdown-divider"></div>      <a class="dropdown-item" href="/sign-out/">退出登录</a>    </div>'))):($("#header-menu").append($('<li class="nav-user"><div><img class="current-user-head" src="'+userHead+'">'+userMsgPoint+'</div><div id="current_user_dropdown" class="dropdown"><span id="current_user_name" class="current-user-name" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-offset="0,20">'+userName+"<i></i></span></div></li>")),$("#current_user_dropdown").append($('<div class="dropdown-menu  dropdown-menu-right">      <a class="dropdown-item" href="/user/">我的个人信息</a>      <a class="dropdown-item" href="/sign-out/">退出登录</a>    </div>'))),$("#current_user_name").click(function(){$(".nav-user-menu").dropdown("toggle")})}function isNullOrEmpty(str){return void 0===str||(null==str||""==str)}function isNumber(val){var regPos,regNeg=/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/;return!(!/^\d+(\.\d+)?$/.test(val)&&!regNeg.test(val))}function pad(num,n){for(var len=num.toString().length;len<n;)num="0"+num,len++;return num}function getInputCursorPosition(input){var el=$(input).get(0),pos=0;if("selectionStart"in el)pos=el.selectionStart;else if("selection"in document){el.focus();var Sel=document.selection.createRange(),SelLength=document.selection.createRange().text.length;Sel.moveStart("character",-el.value.length),pos=Sel.text.length-SelLength}return pos}Date.prototype.format=function(formatStr){var str=formatStr;return str=(str=(str=(str=(str=(str=(str=(str=str.replace(/yyyy|YYYY/,this.getFullYear())).replace(/MM/,pad(this.getMonth()+1,2))).replace(/dd|DD/,pad(this.getDate(),2))).replace(/HH/,pad(this.getHours(),2))).replace(/hh/,pad(this.getHours()>12?this.getHours()-12:this.getHours(),2))).replace(/mm/,pad(this.getMinutes(),2))).replace(/ii/,pad(this.getMinutes(),2))).replace(/ss/,pad(this.getSeconds(),2))};